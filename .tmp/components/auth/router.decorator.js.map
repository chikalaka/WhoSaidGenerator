{"version":3,"sources":["../../../client/components/auth/router.decorator.js"],"names":[],"mappings":"AAAA;;AAEA,CAAC,YAAW;;AAEV,UAAQ,MAAR,CAAe,iBAAf,EACG,GADH,CACO,UAAS,UAAT,EAAqB,MAArB,EAA6B,IAA7B,EAAmC;;AAEtC,eAAW,GAAX,CAAe,mBAAf,EAAoC,UAAS,KAAT,EAAgB,IAAhB,EAAsB;AACxD,UAAI,CAAC,KAAK,YAAV,EAAwB;AACtB;AACD;;AAED,UAAI,OAAO,KAAK,YAAZ,KAA6B,QAAjC,EAA2C;AACzC,aAAK,OAAL,CAAa,KAAK,YAAlB,EAAgC,EAAE,IAAlC,EACG,IADH,CACQ,eAAO;AACX,cAAI,GAAJ,EAAS;AACP;AACD;;AAED,gBAAM,cAAN;AACA,iBAAO,KAAK,UAAL,CAAgB,EAAE,IAAlB,EACJ,IADI,CACC,cAAM;AACV,mBAAO,EAAP,CAAU,KAAK,SAAL,GAAiB,OAA3B;AACD,WAHI,CAAP;AAID,SAXH;AAYD,OAbD,MAaO;AACL,aAAK,UAAL,CAAgB,EAAE,IAAlB,EACG,IADH,CACQ,cAAM;AACV,cAAI,EAAJ,EAAQ;AACN;AACD;;AAED,gBAAM,cAAN;AACA,iBAAO,EAAP,CAAU,MAAV;AACD,SARH;AASD;AACF,KA7BD;AA8BD,GAjCH;AAkCD,CApCD","file":"router.decorator.js","sourcesContent":["'use strict';\r\n\r\n(function() {\r\n\r\n  angular.module('whoSaidApp.auth')\r\n    .run(function($rootScope, $state, Auth) {\r\n      // Redirect to login if route requires auth and the user is not logged in, or doesn't have required role\r\n      $rootScope.$on('$stateChangeStart', function(event, next) {\r\n        if (!next.authenticate) {\r\n          return;\r\n        }\r\n\r\n        if (typeof next.authenticate === 'string') {\r\n          Auth.hasRole(next.authenticate, _.noop)\r\n            .then(has => {\r\n              if (has) {\r\n                return;\r\n              }\r\n\r\n              event.preventDefault();\r\n              return Auth.isLoggedIn(_.noop)\r\n                .then(is => {\r\n                  $state.go(is ? 'welcome' : 'login');\r\n                });\r\n            });\r\n        } else {\r\n          Auth.isLoggedIn(_.noop)\r\n            .then(is => {\r\n              if (is) {\r\n                return;\r\n              }\r\n\r\n              event.preventDefault();\r\n              $state.go('game');\r\n            });\r\n        }\r\n      });\r\n    });\r\n})();\r\n"]}